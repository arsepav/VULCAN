# VULCAN

Проект направлен на создание комплексного мобильного приложения и обновление портала "Экологический мониторинг в Камчатском крае" для улучшения управления и охраны особо охраняемых природных территорий (ООПТ) на Камчатке. Приложение включает туристические маршруты с учетом антропогенной нагрузки, возможность сообщать об экологических проблемах. Созданно расширение для портала, которое позволяет мониторить антропогенную нагрузку на ООПТ и маршруты, а так же позволяет актуализировать инфомацию сервиса.

Прототип сервиса находится по ссылке:

http://91.224.86.144:8000/

стандартный логин - admin
стандартный пароль - adminA1

В протопите реализованны функции добавления ООПТ, Туристических объектов и Туристических путей
Страницы отвечающие за это находятся на 2-4 страницах.

Страницы 5, 6 отвечают за мониторинг экологических проблем и позволяют просматривать экологические проблемы как в формате списка, так и на карте.

7 страница позволяет рассматривать заявки на посещение и мониторить нагрузку на ООПТ и маршут в тот период времени, когда турист хочет посетить Маршрут

## Проект состоит из 3 основных частей:

Front-end, Back-end и мобильное приложение.

## Front-end

Выполнен с использованием Javascript, html и css.

Использована библиотека leaflet - необходимая для создания интерактивных карт.

Не требует установки дополнительных компонентов.

## Back-end

Выполнен с использованием языка Python 3.10 и базы данных Postgres

### Основные использованные библиотеки Python:
- FastAPI - отвечает за создание энд-поинтов приложения
- SQL alchemy - отвечает за связь с базой данных
- torch - использован для сегментации изображений
- cv2 - использован для определения контура сегментированного изображения

полный список библиотек находится в файле requirements.txt, все зависимости могут быть установленных с помощью комманды:

```
pip install -r requirements.txt
```

### Для Postgres использовано расширение PostGis, которое позволяет хроанить геоданные


## Сегментация космических снимков

Для сегментации была использована библиотека Torch, так как она предоставляет мощные инструменты для глубокого обучения и обработки изображений, включая сегментацию.
Была использована архитектура U-Net, поскольку она является одной из наиболее эффективных и широко применяемых архитектур для задач сегментации изображений.

Краткий алгорим сегментации:

- на вход ожидается 2 файла:
    1. файл в формате .jp2 - само изображение
    2. файл в формате .jp2.aux.xml - информация об изображении

- изображение разбивается на части размером 128x128 и передается для сегментации в модель Unet

- после сегментации изображение соединяется и с помощью библиотеки cv2 определяются контуры и преобразуются в формат geojson


для сегментации реализованна функция segmentation_prod.segment_with_coordinates, а так же добавлен энд-поинт /segment_file/

Важно, что в прототипе данных энд-поинт не работает, так как вычислительной мощности сервера не достаточно для сегментации.

Для стабильной работы сегментации необходимо не менее 8ГБ оперативной памяти, для ускорения работы сегментации можно использовать графический ускоритель - GPU.
На локальной машине время работы алгоритма - около 1 минуты.

## Настройка проекта


структура директорий:
```
vulcan
    android
    back
        __init__.py
        models - необходимо создать директорию
            unet_trained.model - необходимо добавить
        files - необходимо создать директорию
        segmentation
        src
        temp_files
        config.json - необходимо создать файл конфигурации по шаблону
        requirements.txt
        run.py - запуск приложения
    files
    front
    static
```

шаблон файла config.json:

```
{
  "connection_string": "postgresql+psycopg2://user:password@<your_ip>:5432/<your_db_name>",
  "secret_key": "Укажите секретный ключ, который будет использован для авториизации пользователей",
  "ip": "Укажите ваш IP адрес",
  "upload_dir": "../files",
  "segmentation": true, если машина достаточно мощная для сегментации изображений, иначе false
}
```


для запуска необходимо перейти в директорию /back и выполнить комманду:

```
python run.py
```


## Мобильное приложение:

